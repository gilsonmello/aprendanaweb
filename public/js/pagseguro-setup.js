function setSenderHash(){var e=document.querySelector("#pay"),t=PagSeguroDirectPayment.getSenderHash();if(null==document.querySelector("input[name=senderHash]")){var r=document.createElement("input");r.setAttribute("name","senderHash"),r.setAttribute("type","hidden"),r.setAttribute("value",t),e.appendChild(r)}}function validateCPF(e){var t,r,a,n,i,l;if(l=1,e.length<11)return!1;for(n=0;n<e.length-1;n++)if(e.charAt(n)!=e.charAt(n+1)){l=0;break}if(l)return!1;for(t=e.substring(0,9),r=e.substring(9),a=0,n=10;n>1;n--)a+=t.charAt(10-n)*n;if(i=a%11<2?0:11-a%11,i!=r.charAt(0))return!1;for(t=e.substring(0,10),a=0,n=11;n>1;n--)a+=t.charAt(11-n)*n;return i=a%11<2?0:11-a%11,i==r.charAt(1)}function setCardBrand(){$("#cardNumber").blur(function(){var e=document.querySelector("#cardNumber").value;null!=e&&PagSeguroDirectPayment.getBrand({cardBin:e.replace(/ /g,""),success:function(t){var r=document.querySelector("#pay"),a=JSON.stringify(t.brand.name).replace(/"/g,"");if(null==document.querySelector("input[name=cardBrand]")){var n=document.createElement("input");n.setAttribute("name","cardBrand"),n.setAttribute("type","hidden"),n.setAttribute("value",a),r.appendChild(n),setInstallmentAmount()}else document.querySelector("input[name=cardBrand]").value=a;$(".credit-card-brand-icon").removeClass("fa-credit-card").addClass("fa-cc-"+a),$(".invalid-card-number").remove(),$("#cardNumber").css("background-color","initial"),(""==a||null==a||e.replace(/ /g,"").length>20)&&($("#cardNumber").parent().find("label").after('<i data-toggle="tooltip" title="Cartão inválido" class="fa fa-warning invalid-card-number" style="color: red"></i>'),$("#cardNumber").after('<p class="invalid-card-number" style="color: red;">Cartão inválido</p>'),$("#cardNumber").css({"background-color":"rgba(249, 3, 3, 0.37)"}))},error:function(e,t,r){$(".invalid-card-number").remove(),$("#cardNumber").parent().find("label").after('<i data-toggle="tooltip" title="Cartão inválido" class="fa fa-warning invalid-card-number" style="color: red"></i>'),$("#cardNumber").after('<p class="invalid-card-number" style="color: red;">Cartão inválido</p>'),$("#cardNumber").css({"background-color":"rgba(249, 3, 3, 0.37)"})}})})}function setCardToken(){var e={cardNumber:document.getElementById("cardNumber").value,brand:document.querySelector("input[name=cardBrand]").value,cvv:document.getElementById("cvv").value,expirationMonth:document.querySelector("#expirationMonth option:checked").value,expirationYear:document.querySelector("#expirationYear option:checked").value,success:function(e){var t=document.querySelector("#pay"),r=JSON.stringify(e.card.token).replace(/"/g,"");if(null==document.querySelector("input[name=cardToken]")){var a=document.createElement("input");a.setAttribute("name","cardToken"),a.setAttribute("type","hidden"),a.setAttribute("value",r),t.appendChild(a)}else document.querySelector("input[name=cardToken]").value=r},error:function(e){}};PagSeguroDirectPayment.createCardToken(e)}function setInstallmentAmount(){var e=document.querySelector("input[name=cardBrand]").value,t=document.querySelector("#pay");PagSeguroDirectPayment.getInstallments({amount:document.getElementById("amount").value,maxInstallmentNoInterest:10,brand:e,success:function(r){var a=JSON.parse(JSON.stringify(r)).installments,n=document.getElementById("max_installments").value;if("unlimited"==n&&(n=-1),null==document.querySelector("input[name=installmentAmount]")){a[e].forEach(function(e){if(e.installmentAmount>20&&(n==-1||e.quantity<=n)||1==e.quantity){var t="<option value='"+e.quantity+"'>";t=t+e.quantity+"x de R$ "+e.installmentAmount.toFixed(2).replace(".",",")+"</option>",$("#installments").append(t)}}),$("#card-placeholder").remove();var i=a[e][0].installmentAmount,l=document.createElement("input");l.setAttribute("name","installmentAmount"),l.setAttribute("type","hidden"),l.setAttribute("value",i),t.appendChild(l)}else{var o=document.querySelector("#installments option:checked").value,i=a[e][o-1].installmentAmount;document.querySelector("input[name=installmentAmount]").value=i}}})}function validateCreditCardFields(){var e=!0,t=$("#credit-card-pay");return $(".fa-warning").remove(),$(".p-error").remove(),t.find("input").each(function(){if(isEmpty($(this))&&""==$(this).val())e=!1,$(this).css("background-color","rgba(249, 3, 3, 0.37)"),$(this).parent().find("label").after('&nbsp;<i data-toggle="tooltip" title="Campo obrigatório" class="fa fa-warning" style="color: red"></i>'),$(this).after('<p class="p-error" style="color: red;">Campo Obrigatório</p>');else{$(this).css("background-color","initial"),$(".invalid-card-number").remove();var t=document.querySelector("#cardNumber").value;null!=t&&PagSeguroDirectPayment.getBrand({cardBin:t.replace(/ /g,""),success:function(e){var r=document.querySelector("#pay"),a=JSON.stringify(e.brand.name).replace(/"/g,"");if(null==document.querySelector("input[name=cardBrand]")){var n=document.createElement("input");n.setAttribute("name","cardBrand"),n.setAttribute("type","hidden"),n.setAttribute("value",a),r.appendChild(n),setInstallmentAmount()}else document.querySelector("input[name=cardBrand]").value=a;$(".credit-card-brand-icon").removeClass("fa-credit-card").addClass("fa-cc-"+a),$(".invalid-card-number").remove(),(""==a||null==a||t.replace(/ /g,"").length>20)&&($("#cardNumber").parent().find("label").after('<i data-toggle="tooltip" title="Cartão inválido" class="fa fa-warning invalid-card-number" style="color: red"></i>'),$("#cardNumber").after('<p class="invalid-card-number" style="color: red;">Cartão inválido</p>'),$("#cardNumber").css({"background-color":"rgba(249, 3, 3, 0.37)"}))},error:function(e,t,r){$(".invalid-card-number").remove(),$("#cardNumber").parent().find("label").after('<i data-toggle="tooltip" title="Cartão inválido" class="fa fa-warning invalid-card-number" style="color: red"></i>'),$("#cardNumber").after('<p class="invalid-card-number" style="color: red;">Cartão inválido</p>'),$("#cardNumber").css({"background-color":"rgba(249, 3, 3, 0.37)"})}})}}),e}function isEmpty(e){return!$.trim(e.html())}function parseDate(e){var t=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);return t?new Date(t[3],t[2]-1,t[1]):null}PagSeguroDirectPayment.setSessionId($("[name='pedido_id']").val()),document.querySelector(".btn-boleto").addEventListener("click",function(e){document.querySelector("#method").setAttribute("value","boleto");var t=document.querySelector("#pay");setSenderHash(),$("#button").attr("disabled","disabled"),$("#button").attr("disabled","disabled"),document.getElementById("loading").style.display="block",$.ajax({url:t.getAttribute("action"),type:"post",data:$("#pay").serialize(),success:function(e){var t="<input name='url_boleto' id='url_boleto' type='hidden'>";document.querySelector("#print-boleto").innerHTML=t,$("#pay").attr("action","/carrinho/boleto-emitido");var r=setInterval(function(){$("#url_boleto").length>0&&""!=e.paymentLink&&void 0!=e.paymentLink&&null!=e.paymentLink&&($("#url_boleto").val(e.paymentLink),$("#pay").submit(),clearInterval(r))},3e3)}})}),document.querySelector(".btn-credit-card").addEventListener("click",function(e){return document.querySelector("#method").setAttribute("value","creditCard"),$("#button").attr("disabled","disabled"),document.getElementById("loadingCredit").style.display="block",validateCreditCardFields()===!1?(document.getElementById("loadingCredit").style.display="none",$("#button").removeAttr("disabled"),!1):void setTimeout(function(){var e=document.querySelector("#pay");return setSenderHash(),"creditCard"==document.querySelector("#method").getAttribute("value")&&(setInstallmentAmount(),setCardToken()),setTimeout(function(){e.submit()},2e3),!1},1e3)});var valid_fields=!1;setCardBrand(),document.querySelector("#pay").addEventListener("submit",function(e){e.preventDefault()}),$(document).keypress(function(e){var t=null;return t=e.keyCode?e.keyCode:e.which,13!=t}),$(document).ready(function(){$(".personal_id").val(""),$(".birthdate").val(""),$("#billAddressComplement").val("-"),$(".invalid-personal-id").remove(),$("#personal_id").blur(function(){$(".label-error").remove(),$(".p-error").remove(),console.log($(this).parent().find("i"),$(this).parent()),$(this).parent().find("i").remove(),validateCPF($(this).val().replace(".","").replace(".","").replace("-",""))||($(this).css({"background-color":"rgba(249, 3, 3, 0.37)"}),$(this).parent().find("label").after('<i data-toggle="tooltip" title="CPF Inválido" class="fa fa-warning invalid-personal-id" style="color: red"></i>'),$(this).after('<p class="p-error" style="color: red;">CPF Inválido</p>'))}),$(".birthdate").blur(function(){$(".invalid-birthdate").remove(),null==parseDate($(this).val())&&$(this).parent().find("label").after('<i data-toggle="tooltip" title="Data de Nascimento Inválida" class="fa fa-warning invalid-birthdate" style="color: red"></i>')})});